virtualenv_create(env_name, python_version = "3.11")
pacman::p_load(
tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, this.path
)
setwd(this.path::here())
# 1. LOAD FIT OBJECT ----
# retrieves the limit object of the hamiltonian flow.
fit <- readRDS("../results/fit_full_volatility_final.rds")
# 2. SAMPLER DIAGNOSTICS (E-BFMI, Divergences, Treedepth) ----
# Categorical Logic: Measuring the 'Efficiency Functor'
# E-BFMI > 0.3 confirms that energy transitions are faithful to the manifold.
sampler_diags <- fit$sampler_diagnostics()
calc_ebfmi <- function(energy_vec) {
sum(diff(energy_vec)^2) / (length(energy_vec) * var(energy_vec))
}
ebfmi_vals <- apply(sampler_diags[, , "energy__"], 2, calc_ebfmi)
div_counts <- apply(sampler_diags[, , "divergent__"], 2, sum)
max_td <- apply(sampler_diags[, , "treedepth__"], 2, max)
message("--- NUTS Sampler Audit ---")
for (i in 1:length(ebfmi_vals)) {
message(paste0(
"Chain ", i,
" | E-BFMI: ", round(ebfmi_vals[i], 3),
" | Div: ", div_counts[i],
" | Max TD: ", max_td[i]
))
}
fit_summary <- fit$summary(
variables = c("mu_beta", "mu_kappa", "mu_log_tau", "sigma_beta_trait", "sigma_beta_session"),
.rhat = posterior::rhat,
.ess_bulk = posterior::ess_bulk,
.ess_tail = posterior::ess_tail
)
fit_summary <- fit$summary(
variables = c("mu_beta", "mu_kappa", "sigma_beta_trait", "sigma_beta_session"),
.rhat = posterior::rhat,
.ess_bulk = posterior::ess_bulk,
.ess_tail = posterior::ess_tail
)
cat("\n--- Convergence Summary (Cognitive Parameters) ---\n")
print(fit_summary)
View(fit_summary)
# 4. CHAIN-WISE DISCREPANCY CHECK (FOR R-HAT > 1.1) ----
# Categorical Logic: Identifying the 'Island' occupied by each Chain Morphism.
# If R-hat is high, this table reveals which chain is the outlier.
cat("\n--- Chain-Wise Parameter Medians (Identifying the 'Island') ---\n")
target_vars <- c("mu_beta[1,1]", "mu_log_tau[1,1]")
draws_all <- fit$draws(variables = target_vars)
target_vars <- c("mu_beta[1,1]")
draws_all <- fit$draws(variables = target_vars)
chain_medians <- draws_all %>%
summarise_draws(median, .chain = TRUE) %>%
select(chain, variable, median) %>%
pivot_wider(names_from = variable, values_from = median)
target_vars <- c("mu_beta[1,1]")
draws_all <- fit$draws(variables = target_vars)
chain_medians <- draws_all %>%
summarise_draws(median, .chain = TRUE) %>%
select(chain, variable, median) %>%
pivot_wider(names_from = variable, values_from = median)
# Logic: Automatic Identification of Parameters that fail the 'limit object' criteria.
problematic_params <- fit$summary() %>%
filter(rhat > 1.05 | ess_bulk < 400) %>%
arrange(desc(rhat))
if (nrow(problematic_params) > 0) {
cat("\n--- WARNING: Parameters failing convergence criteria ---\n")
cat("A high R-hat (e.g., > 1.1) means the chains are NOT in the same mode.\n")
print(head(problematic_params, 20))
} else {
cat("\nSUCCESS: All parameters satisfy R-hat < 1.05 and ESS > 400.\n")
}
# 5. VISUALIZATION: THE FUZZY CATERPILLAR TEST ----
# Categorical Intuition: Chains should be indistinguishable fibers.
draws_array <- fit$draws(variables = target_vars)
p_trace <- mcmc_trace(draws_array) +
theme_minimal() +
labs(title = "Chain Overlap (The Caterpillar Test)")
p_trace
# 6. VISUALIZATION: POSTERIOR UNIFICATION ----
p_dens <- mcmc_dens_overlay(draws_array) +
theme_minimal() +
labs(title = "Unified Marginal Posterior")
# 7. JOINT MANIFOLD: BETA-TAU IDENTIFIABILITY ----
draws_df <- as_draws_df(draws_array) %>%
mutate(mu_tau = exp(`mu_log_tau[1,1]`))
p_dens
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
# Mapping Definition (Adjust based on your actual drug_map)
# Assuming: 1 = Vehicle/Naive (Reference), 2 = Treatment Group
ctx_names <- c("1" = "Baseline", "2" = "Moderate", "3" = "High")
# 2. EXTRACT DRAWS ----
# We extract the 'base' (Vehicle) and 'delta' (Drug Offset)
draws_df <- as_draws_df(fit$draws(variables = c("base_kappa", "delta_kappa", "base_beta", "delta_beta")))
fit
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, ggdist)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
# Mapping Definition
# Assuming: 1 = Vehicle/Naive (Reference), 2 = Treatment Group
ctx_names <- c("1" = "Baseline", "2" = "Moderate", "3" = "High")
# 2. EXTRACT DRAWS ----
# We extract the absolute means for kappa and beta.
# In this matrix version, the drug effect is NOT a separate parameter;
# it must be calculated as a contrast.
draws_df <- as_draws_df(fit$draws(variables = c("mu_kappa", "mu_beta")))
# 3. CALCULATE CONTRASTS (Drug - Vehicle) ----
# We pivot the draws to long format, extract indices, then calculate the difference.
contrast_df <- draws_df %>%
pivot_longer(
cols = starts_with("mu_kappa"),
names_to = "parameter",
values_to = "value"
) %>%
# Extract indices: mu_kappa[drug_id, context_id]
mutate(
drug_id = as.numeric(str_extract(parameter, "(?<=\\[)\\d+")),
ctx_id = as.numeric(str_extract(parameter, "(?<=,)\\d+"))
) %>%
# Narrow down to the groups of interest
filter(drug_id %in% c(1, 2)) %>%
# Spread drugs to columns to perform subtraction within each draw
select(.draw, ctx_id, drug_id, value) %>%
pivot_wider(names_from = drug_id, values_from = value, names_prefix = "drug_") %>%
mutate(
diff_value = drug_2 - drug_1, # The Contrast Morphism: Treatment - Vehicle
context = ctx_names[as.character(ctx_id)]
)
# 4. STATISTICAL SUMMARY ----
stats_summary <- contrast_df %>%
group_by(context) %>%
summarise(
median_diff = median(diff_value),
q05 = quantile(diff_value, 0.05),
q95 = quantile(diff_value, 0.95),
pd = max(sum(diff_value > 0), sum(diff_value < 0)) / n(), # Directional Probability
sig = ifelse(pd > 0.95, "*", "") # Marker for 95% certainty
)
print("--- Statistical Summary: Drug Effect (Treatment - Vehicle) on Kappa ---")
print(stats_summary)
# 5. VISUALIZATION ----
p_diffs <- ggplot(contrast_df, aes(x = diff_value, y = context, fill = context)) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
stat_halfeye(alpha = 0.7) +
theme_minimal() +
scale_fill_viridis_d(option = "mako", begin = 0.3, end = 0.8) +
labs(
title = "Drug Effect on Information Seeking (Kappa)",
subtitle = "Calculated Contrast: mu_kappa[Drug] - mu_kappa[Vehicle]",
x = "Difference in Kappa (Positive = Drug Increases Curiosity)",
y = "Cognitive Context"
) +
theme(legend.position = "none")
# 6. CALCULATE PROBABILITY OF REDUCTION ----
# Probability that the drug reduces curiosity (Kappa_diff < 0)
reduction_probs <- contrast_df %>%
group_by(context) %>%
summarise(prob_reduction = mean(diff_value < 0))
print("--- Probability that Drug REDUCES Curiosity ---")
print(reduction_probs)
# Save result
dir.create("../results", showWarnings = FALSE)
p_diffs
# 3. CALCULATE CONTRASTS (Drug - Vehicle) ----
# We pivot the draws to long format, extract indices, then calculate the difference.
contrast_df <- draws_df %>%
pivot_longer(
cols = starts_with("mu_beta"),
names_to = "parameter",
values_to = "value"
) %>%
# Extract indices: mu_kappa[drug_id, context_id]
mutate(
drug_id = as.numeric(str_extract(parameter, "(?<=\\[)\\d+")),
ctx_id = as.numeric(str_extract(parameter, "(?<=,)\\d+"))
) %>%
# Narrow down to the groups of interest
filter(drug_id %in% c(1, 2)) %>%
# Spread drugs to columns to perform subtraction within each draw
select(.draw, ctx_id, drug_id, value) %>%
pivot_wider(names_from = drug_id, values_from = value, names_prefix = "drug_") %>%
mutate(
diff_value = drug_2 - drug_1, # The Contrast Morphism: Treatment - Vehicle
context = ctx_names[as.character(ctx_id)]
)
# 4. STATISTICAL SUMMARY ----
stats_summary <- contrast_df %>%
group_by(context) %>%
summarise(
median_diff = median(diff_value),
q05 = quantile(diff_value, 0.05),
q95 = quantile(diff_value, 0.95),
pd = max(sum(diff_value > 0), sum(diff_value < 0)) / n(), # Directional Probability
sig = ifelse(pd > 0.95, "*", "") # Marker for 95% certainty
)
print("--- Statistical Summary: Drug Effect (Treatment - Vehicle) on Kappa ---")
print(stats_summary)
# 5. VISUALIZATION ----
p_diffs <- ggplot(contrast_df, aes(x = diff_value, y = context, fill = context)) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
stat_halfeye(alpha = 0.7) +
theme_minimal() +
scale_fill_viridis_d(option = "mako", begin = 0.3, end = 0.8) +
labs(
title = "Drug Effect on Information Seeking (Kappa)",
subtitle = "Calculated Contrast: mu_kappa[Drug] - mu_kappa[Vehicle]",
x = "Difference in Kappa (Positive = Drug Increases Curiosity)",
y = "Cognitive Context"
) +
theme(legend.position = "none")
# 6. CALCULATE PROBABILITY OF REDUCTION ----
# Probability that the drug reduces curiosity (Kappa_diff < 0)
reduction_probs <- contrast_df %>%
group_by(context) %>%
summarise(prob_reduction = mean(diff_value < 0))
print("--- Probability that Drug REDUCES Curiosity ---")
print(reduction_probs)
p_diffs
mcmc_trace(draws_array, pars = "mu_kappa[2,3]")
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, ggdist, bayestestR)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
# Mapping Definition
# Assuming: 1 = Vehicle/Naive (Reference), 2 = Treatment Group
ctx_names <- c("1" = "Baseline", "2" = "Moderate", "3" = "High")
# 2. EXTRACT DRAWS ----
# We extract the absolute means for kappa and beta.
draws_df <- as_draws_df(fit$draws(variables = c("mu_kappa", "mu_beta")))
# 3. CALCULATE CONTRASTS (Drug - Vehicle) ----
contrast_df <- draws_df %>%
pivot_longer(
cols = starts_with("mu_kappa"),
names_to = "parameter",
values_to = "value"
) %>%
mutate(
drug_id = as.numeric(str_extract(parameter, "(?<=\\[)\\d+")),
ctx_id = as.numeric(str_extract(parameter, "(?<=,)\\d+"))
) %>%
filter(drug_id %in% c(1, 2)) %>%
select(.draw, ctx_id, drug_id, value) %>%
pivot_wider(names_from = drug_id, values_from = value, names_prefix = "drug_") %>%
mutate(
diff_value = drug_2 - drug_1, # The Contrast Morphism: Treatment - Vehicle
context = ctx_names[as.character(ctx_id)]
)
# 4. BAYES FACTOR CALCULATION ----
# Categorical Logic: Using the Savage-Dickey Density Ratio.
# Prior for mu_kappa was Normal(0.1, 0.5).
# The prior for the difference (mu_2 - mu_1) is Normal(0, sqrt(0.5^2 + 0.5^2)) = Normal(0, 0.707).
prior_diff <- distribution_normal(nrow(contrast_df), mean = 0, sd = 0.707)
bf_results <- contrast_df %>%
group_by(context) %>%
do(as.data.frame(bayesfactor_parameters(.$diff_value, prior = prior_diff, null = 0))) %>%
rename(BF10 = BF)
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, ggdist, bayestestR)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
# Mapping Definition
# Assuming: 1 = Vehicle/Naive (Reference), 2 = Treatment Group
ctx_names <- c("1" = "Baseline", "2" = "Moderate", "3" = "High")
# 2. EXTRACT DRAWS ----
# We extract the absolute means for kappa and beta.
draws_df <- as_draws_df(fit$draws(variables = c("mu_kappa", "mu_beta")))
# 3. CALCULATE CONTRASTS (Drug - Vehicle) ----
contrast_df <- draws_df %>%
pivot_longer(
cols = starts_with("mu_kappa"),
names_to = "parameter",
values_to = "value"
) %>%
mutate(
drug_id = as.numeric(str_extract(parameter, "(?<=\\[)\\d+")),
ctx_id = as.numeric(str_extract(parameter, "(?<=,)\\d+"))
) %>%
filter(drug_id %in% c(1, 2)) %>%
select(.draw, ctx_id, drug_id, value) %>%
pivot_wider(names_from = drug_id, values_from = value, names_prefix = "drug_") %>%
mutate(
diff_value = drug_2 - drug_1, # The Contrast Morphism: Treatment - Vehicle
context = ctx_names[as.character(ctx_id)]
)
# 4. BAYES FACTOR CALCULATION ----
# Categorical Logic: Using the Savage-Dickey Density Ratio.
# Prior for mu_kappa was Normal(0.1, 0.5).
# The prior for the difference (mu_2 - mu_1) is Normal(0, sqrt(0.5^2 + 0.5^2)) = Normal(0, 0.707).
prior_diff <- distribution_normal(nrow(contrast_df), mean = 0, sd = 0.707)
bf_results <- contrast_df %>%
group_by(context) %>%
do(as.data.frame(bayesfactor_parameters(.$diff_value, prior = prior_diff, null = 0))) %>%
rename(BF10 = BF)
# 5. STATISTICAL SUMMARY ----
stats_summary <- contrast_df %>%
group_by(context) %>%
summarise(
median_diff = median(diff_value),
q05 = quantile(diff_value, 0.05),
q95 = quantile(diff_value, 0.95),
pd = max(sum(diff_value > 0), sum(diff_value < 0)) / n(), # Directional Probability
) %>%
left_join(bf_results %>% select(context, BF10), by = "context") %>%
mutate(evidence = case_when(
BF10 > 10 ~ "Strong Evidence",
BF10 > 3 ~ "Moderate Evidence",
BF10 < 1 / 3 ~ "Evidence for Null",
TRUE ~ "Anecdotal"
))
print("--- Statistical Summary: Drug Effect (Treatment - Vehicle) on Kappa ---")
print(stats_summary)
bf_results <- contrast_df %>%
group_by(context) %>%
do(as.data.frame(bayesfactor_parameters(.$diff_value, prior = prior_diff, null = 0))) %>%
rename(BF10 = BF)
contrast_df %>%
group_by(context) %>%
do(as.data.frame(bayesfactor_parameters(.$diff_value, prior = prior_diff, null = 0))) %
prior_diff
bf_results <- contrast_df %>%
group_by(context) %>%
do(as.data.frame(bayesfactor_parameters(.$diff_value, prior = prior_diff, null = 0))) %>%
rename(BF10 = BF)
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, ggdist, bayestestR)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, ggdist, bayestestR)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
# Mapping Definition
# Assuming: 1 = Vehicle/Naive (Reference), 2 = Treatment Group
ctx_names <- c("1" = "Baseline", "2" = "Moderate", "3" = "High")
# 2. EXTRACT DRAWS ----
# We extract the absolute means for kappa and beta.
draws_df <- as_draws_df(fit$draws(variables = c("mu_kappa", "mu_beta")))
# 3. CALCULATE CONTRASTS (Drug - Vehicle) ----
contrast_df <- draws_df %>%
pivot_longer(cols = starts_with("mu_kappa"),
names_to = "parameter",
values_to = "value") %>%
mutate(
drug_id = as.numeric(str_extract(parameter, "(?<=\\[)\\d+")),
ctx_id = as.numeric(str_extract(parameter, "(?<=,)\\d+"))
) %>%
filter(drug_id %in% c(1, 2)) %>%
select(.draw, ctx_id, drug_id, value) %>%
pivot_wider(names_from = drug_id, values_from = value, names_prefix = "drug_") %>%
mutate(
diff_value = drug_2 - drug_1, # The Contrast Morphism: Treatment - Vehicle
context = ctx_names[as.character(ctx_id)]
)
# 4. BAYES FACTOR CALCULATION ----
# Categorical Logic: Using the Savage-Dickey Density Ratio.
# Prior for mu_kappa was Normal(0.1, 0.5).
# The prior for the difference (mu_2 - mu_1) is Normal(0, sqrt(0.5^2 + 0.5^2)) = Normal(0, 0.707).
prior_diff <- distribution_normal(nrow(contrast_df), mean = 0, sd = 0.707)
# Improved robust extraction of Bayes Factor
bf_results <- contrast_df %>%
group_by(context) %>%
summarise(
BF10 = as.numeric(bayesfactor_parameters(diff_value, prior = prior_diff, null = 0)),
.groups = "drop"
)
# 5. STATISTICAL SUMMARY ----
stats_summary <- contrast_df %>%
group_by(context) %>%
summarise(
median_diff = median(diff_value),
q05 = quantile(diff_value, 0.05),
q95 = quantile(diff_value, 0.95),
pd = max(sum(diff_value > 0), sum(diff_value < 0)) / n(), # Directional Probability
.groups = "drop"
) %>%
left_join(bf_results, by = "context") %>%
mutate(evidence = case_when(
BF10 > 10 ~ "Strong Evidence",
BF10 > 3  ~ "Moderate Evidence",
BF10 < 1/3 ~ "Evidence for Null",
TRUE      ~ "Anecdotal"
))
print("--- Statistical Summary: Drug Effect (Treatment - Vehicle) on Kappa ---")
print(stats_summary)
# 6. VISUALIZATION ----
p_diffs <- ggplot(contrast_df, aes(x = diff_value, y = context, fill = context)) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red") +
stat_halfeye(alpha = 0.7) +
geom_text(data = stats_summary,
aes(x = median_diff, y = context, label = paste0("BF10: ", round(BF10, 2))),
vjust = -2.5, fontface = "bold") +
theme_minimal() +
scale_fill_viridis_d(option = "mako", begin = 0.3, end = 0.8) +
labs(
title = "Drug Effect on Information Seeking (Kappa)",
subtitle = "Contrast: mu_kappa[Drug] - mu_kappa[Vehicle]. BF10 > 3 indicates reliable effect.",
x = "Difference in Kappa (Positive = Drug Increases Curiosity)",
y = "Cognitive Context"
) +
theme(legend.position = "none")
p_diffs
# 7. CALCULATE PROBABILITY OF REDUCTION ----
reduction_probs <- contrast_df %>%
group_by(context) %>%
summarise(prob_reduction = mean(diff_value < 0), .groups = "drop")
print("--- Probability that Drug REDUCES Curiosity ---")
print(reduction_probs)
# 3. CALCULATE CONTRASTS (Drug - Vehicle) ----
contrast_df <- draws_df %>%
pivot_longer(cols = starts_with("mu_beta"),
names_to = "parameter",
values_to = "value") %>%
mutate(
drug_id = as.numeric(str_extract(parameter, "(?<=\\[)\\d+")),
ctx_id = as.numeric(str_extract(parameter, "(?<=,)\\d+"))
) %>%
filter(drug_id %in% c(1, 2)) %>%
select(.draw, ctx_id, drug_id, value) %>%
pivot_wider(names_from = drug_id, values_from = value, names_prefix = "drug_") %>%
mutate(
diff_value = drug_2 - drug_1, # The Contrast Morphism: Treatment - Vehicle
context = ctx_names[as.character(ctx_id)]
)
# 4. BAYES FACTOR CALCULATION ----
# Categorical Logic: Using the Savage-Dickey Density Ratio.
# Prior for mu_kappa was Normal(0.1, 0.5).
# The prior for the difference (mu_2 - mu_1) is Normal(0, sqrt(0.5^2 + 0.5^2)) = Normal(0, 0.707).
prior_diff <- distribution_normal(nrow(contrast_df), mean = 0, sd = 0.707)
# Improved robust extraction of Bayes Factor
bf_results <- contrast_df %>%
group_by(context) %>%
summarise(
BF10 = as.numeric(bayesfactor_parameters(diff_value, prior = prior_diff, null = 0)),
.groups = "drop"
)
# 5. STATISTICAL SUMMARY ----
stats_summary <- contrast_df %>%
group_by(context) %>%
summarise(
median_diff = median(diff_value),
q05 = quantile(diff_value, 0.05),
q95 = quantile(diff_value, 0.95),
pd = max(sum(diff_value > 0), sum(diff_value < 0)) / n(), # Directional Probability
.groups = "drop"
) %>%
left_join(bf_results, by = "context") %>%
mutate(evidence = case_when(
BF10 > 10 ~ "Strong Evidence",
BF10 > 3  ~ "Moderate Evidence",
BF10 < 1/3 ~ "Evidence for Null",
TRUE      ~ "Anecdotal"
))
print("--- Statistical Summary: Drug Effect (Treatment - Vehicle) on Kappa ---")
print(stats_summary)
pacman::p_load(tidyverse, cmdstanr, posterior, bayesplot, patchwork, scales, ggdist, bayestestR)
# 1. LOAD DATA ----
fit <- readRDS("../results/fit_full_volatility_final.rds")
# 2. EXTRACT DRAWS ----
# Target: mu_kappa[drug, context]
draws_df <- as_draws_df(fit$draws(variables = "mu_kappa"))
# 3. CALCULATE INTERACTION MORPHISM ----
# Drug 1 = Vehicle, Drug 2 = FTCS
# Context 1 = Baseline, Context 3 = High Uncertainty
interaction_df <- draws_df %>%
mutate(
# Drug effects (Morphisms) per context
delta_base = `mu_kappa[2,1]` - `mu_kappa[1,1]`, # Usually negative
delta_high = `mu_kappa[2,3]` - `mu_kappa[1,3]`, # Usually positive
# The Interaction: Difference of Differences
# This measures the "swing" or "gating loss"
interaction_effect = delta_high - delta_base
)
# 4. STATISTICAL INFERENCE FOR GATING ----
# Prior for the interaction based on mu_kappa ~ N(0.1, 0.5)
# Var(Interaction) = Var(d23) + Var(d13) + Var(d21) + Var(d11) = 4 * 0.5^2 = 1.0
# SD = 1.0
prior_interaction <- distribution_normal(nrow(interaction_df), mean = 0, sd = 1.0)
summary_stats <- interaction_df %>%
summarise(
median_interaction = median(interaction_effect),
q05 = quantile(interaction_effect, 0.05),
q95 = quantile(interaction_effect, 0.95),
pd = max(sum(interaction_effect > 0), sum(interaction_effect < 0)) / n(),
BF10 = as.numeric(bayesfactor_parameters(interaction_effect, prior = prior_interaction, null = 0))
)
print("--- Gating-Loss Interaction Analysis (High vs Baseline) ---")
print(summary_stats)
# 5. VISUALIZATION OF THE CROSSOVER ----
# We plot the two effects side-by-side and the interaction distribution
p1 <- interaction_df %>%
select(delta_base, delta_high) %>%
pivot_longer(everything(), names_to = "Context", values_to = "Effect") %>%
mutate(Context = factor(Context,
levels = c("delta_base", "delta_high"),
labels = c("Baseline Context", "High Uncertainty")
)) %>%
ggplot(aes(x = Effect, y = Context, fill = Context)) +
geom_vline(xintercept = 0, linetype = "dashed") +
stat_halfeye() +
scale_fill_manual(values = c("#440154", "#fde725")) +
theme_minimal() +
labs(title = "Context-Dependent Drug Effects", x = "Effect Size (FTCS - Vehicle)")
p2 <- ggplot(interaction_df, aes(x = interaction_effect)) +
geom_vline(xintercept = 0, linetype = "dotted") +
stat_halfeye(fill = "gray70", .width = c(0.89, 0.95)) +
theme_minimal() +
labs(
title = "Interaction Morphism (Gating Test)",
subtitle = paste0("Evidence for Gating Loss (BF10): ", round(summary_stats$BF10, 2)),
x = "Interaction Magnitude (ΔHigh - ΔBase)"
)
final_plot <- p1 / p2 + plot_annotation(title = "Orexin Gating of Information Seeking")
final_plot
print(summary_stats)
p2
